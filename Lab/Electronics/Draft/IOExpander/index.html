<!-- (ฅ^･ω･^ฅ) ﾆｬｰ -->

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja" prefix="og: http://ogp.me/ns#">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-114187773-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag("js", new Date());
    gtag("config", "UA-114187773-1");
  </script>
  <!-- End Google Analytics -->
  <!-- Load Google Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Kosugi+Maru&display=swap" rel="stylesheet">
  <!-- End Google Font -->

  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="@kanade_k_1228" />
  <link rel="shortcut icon" href="https://avatars.githubusercontent.com/u/54773334" />
      <title>I2C IOエクスパンダ MCP23017 の使い方 | Kanade's Website</title>

  <!-- OGP -->
    <!-- END OGP -->
  <link rel="stylesheet" href="https://kanade-k-1228.github.io/.common/style.css" />
    <script type="text/javascript" id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    mjx-container[jax="CHTML"][display="true"] {
      display: block;
      text-align: center;
      margin: 0;
    }
  </style>
  <!-- SyntaxHighlight -->
  <link rel="stylesheet" href="https://kanade-k-1228.github.io/.common/highlight.css" />
  <script src="https://kanade-k-1228.github.io/.common/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad();
  </script>

  <script>
    function tweet() {
      window.open(
        "https://twitter.com/intent/tweet?via=kanade_k_1228&related=kanade_k_1228&url=" +
        location.href +
        "&text=" +
        "I2C IOエクスパンダ MCP23017 の使い方",
        "_blank"
      );
    }
  </script>
</head>

<body>
  <article>
    <header>
      <ul>
        <li><a href="/">ﾎｰﾑ</a></li>
        <li><a href="/Portfolio/">ﾎﾟﾄﾌｫﾘｵ</a></li>
        <li><a href="/Lab/">研究室</a></li>
        <li><a href="/Blog/">雑記</a></li>
      </ul>
      <div id="header-links">
        <a href="https://twitter.com/kanade_k_1228" target="_blank">
          <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="126.444 2.281 589 589"
            style="margin: 0; padding: 0">
            <circle cx="420.944" cy="296.781" r="294.5" fill="#2daae1" />
            <path
              d="M609.773 179.634c-13.891 6.164-28.811 10.331-44.498 12.204 16.01-9.587 28.275-24.779 34.066-42.86a154.78 154.78 0 0 1-49.209 18.801c-14.125-15.056-34.267-24.456-56.551-24.456-42.773 0-77.462 34.675-77.462 77.473 0 6.064.683 11.98 1.996 17.66-64.389-3.236-121.474-34.079-159.684-80.945-6.672 11.446-10.491 24.754-10.491 38.953 0 26.875 13.679 50.587 34.464 64.477a77.122 77.122 0 0 1-35.097-9.686v.979c0 37.54 26.701 68.842 62.145 75.961-6.511 1.784-13.344 2.716-20.413 2.716-4.998 0-9.847-.473-14.584-1.364 9.859 30.769 38.471 53.166 72.363 53.799-26.515 20.785-59.925 33.175-96.212 33.175-6.25 0-12.427-.373-18.491-1.104 34.291 21.988 75.006 34.824 118.759 34.824 142.496 0 220.428-118.052 220.428-220.428 0-3.361-.074-6.697-.236-10.021a157.855 157.855 0 0 0 38.707-40.158z"
              fill="#fff" />
          </svg>
        </a>
        <a href="https://github.com/kanade-k-1228" target="_blank">
          <svg width="50px" height="50px" viewBox="0 0 1024 1024" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd"
              d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z"
              transform="scale(64)" fill="#1B1F23" />
          </svg>
        </a>
        <a href="https://t.co/E5xtfEQs4A" target="_blank">
          <img src="http://kanade-k-1228.github.io/.common/niconico.png" width="50px" height="50px"
            style="border-radius: 50%" /></a>
        <a href="https://www.youtube.com/channel/UCoeuc9-XQ5EpeYSCn4ESpQw" target="_blank">
          <svg width="50px" height="50px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 333333 333333">
            <path
              d="M166667 0c92048 0 166667 74619 166667 166667s-74619 166667-166667 166667S0 258715 0 166667 74619 0 166667 0zm84195 132297s-1678-11849-6843-17052c-6545-6843-13873-6887-17223-7283-24036-1751-60138-1751-60138-1751h-63s-36085 0-60135 1751c-3363 409-10681 437-17223 7283-5168 5203-6811 17052-6811 17052s-1711 13904-1711 27838v13029c0 13905 1709 27837 1709 27837s1678 11849 6811 17061c6542 6843 15139 6621 18977 7350 13761 1314 58457 1710 58457 1710s36133-64 60169-1783c3363-397 10678-438 17223-7284 5168-5202 6843-17065 6843-17065s1711-13904 1711-27837v-13028c-35-13905-1745-27837-1745-27837l-9 9-1-1zm-102010 56674v-48312l46437 24237-46437 24075z"
              fill="red" />
          </svg>
        </a>
      </div>
      <!-- End Top Nav -->
      <!-- Title -->
            <h1 style="margin: 0">I2C IOエクスパンダ MCP23017 の使い方</h1>
            <!-- Date -->
            <!-- Description -->
          </header>

    <!-- TeX Macros -->
    <!-- prettier-ignore -->
    <p style="display: none">
      \[ \newcommand{dn}[3]{\frac{\mathrm{d}^{#3} #1}{\mathrm{d} #2^{#3}}}
      \newcommand{\d}[2]{\frac{\mathrm{d} #1}{\mathrm{d} #2}}
      \newcommand{\dd}[2]{\frac{\mathrm{d}^2 #1}{\mathrm{d} {#2}^2}}
      \newcommand{\ddd}[2]{\frac{\mathrm{d}^3 #1}{\mathrm{d} {#2}^3}}
      \newcommand{\pdn}[3]{\frac{\partial^{#3} #1}{\partial {#2}^{#3}}}
      \newcommand{\pd}[2]{\frac{\partial #1}{\partial #2}}
      \newcommand{\pdd}[2]{\frac{\partial^2 #1}{\partial {#2}^2}}
      \newcommand{\pddd}[2]{\frac{\partial^3 #1}{\partial {#2}^3}}
      \newcommand{\p}{\partial}
      \newcommand{\D}[2]{\frac{\mathrm{D} #1}{\mathrm{D} #2}}
      \newcommand{\Re}{\mathrm{Re}}
      \newcommand{\Im}{\mathrm{Im}}
      \newcommand{\bra}[1]{\left\langle #1 \right|}
      \newcommand{\ket}[1]{\left|#1 \right\rangle}
      \newcommand{\braket}[2]{\left\langle #1 \middle|#2 \right\rangle}
      \newcommand{\inner}[2]{\left\langle #1 ,#2 \right\rangle}
      \newcommand{\l}{\left} \newcommand{\m}{\middle} \newcommand{\r}{\right}
      \newcommand{\f}[2]{\frac{#1}{#2}} \newcommand{\eps}{\varepsilon}
      \newcommand{\ra}{\rightarrow} \newcommand{\F}{\mathcal{F}}
      \newcommand{\L}{\mathcal{L}} \newcommand{\t}{\quad}
      \newcommand{\intinf}{\int_{-\infty}^{+\infty}}
      \newcommand{\R}{\mathcal{R}} \newcommand{\C}{\mathcal{C}}
      \newcommand{\Z}{\mathcal{Z}} \newcommand{\bm}[1]{\boldsymbol{#1}} \]
    </p>

    <!-- Table of Contents -->
        <nav><ul>
<li><a href="#mcp23017">MCP23017</a></li>
<li><a href="#レジスタ">レジスタ</a>
<ul>
<li><a href="#iocon">IOCON</a></li>
</ul></li>
<li><a href="#簡単な使い方">簡単な使い方</a>
<ul>
<li><a href="#デバイスアドレス">デバイスアドレス</a></li>
<li><a href="#設定レジスタ">設定レジスタ</a></li>
<li><a href="#出力">出力</a></li>
<li><a href="#入力">入力</a></li>
</ul></li>
<li><a href="#テスト">テスト</a></li>
</ul></nav>
     <h2 id="mcp23017">MCP23017</h2>
<ul>
<li>I2C 通信で GPIO ピンを拡張する</li>
<li>割り込み出力がある</li>
</ul>
<p><a href="https://akizukidenshi.com/catalog/g/gI-09486/">秋月電子</a></p>
<p><a href="http://ww1.microchip.com/downloads/cn/DeviceDoc/cn026496.pdf">参考：MCP23008 のデータシート</a></p>
<h2 id="レジスタ">レジスタ</h2>
<p>全て 8bit のレジスタです。それぞれのレジスタについて、A/B があります。レジスタの 8bit が 8 本の GPIO ピンに対応しています。</p>
<table>
<thead>
<tr class="header">
<th>名前</th>
<th></th>
<th>機能</th>
<th>値</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>IODIR</td>
<td>RW</td>
<td>入力か出力か？</td>
<td>1:入力 0:出力</td>
<td></td>
</tr>
<tr class="even">
<td>IPOL</td>
<td>RW</td>
<td>入力ピンの極性</td>
<td>1:反転 0:同じ</td>
<td></td>
</tr>
<tr class="odd">
<td>GPINTEN</td>
<td>RW</td>
<td>入力状態変化時に割り込みを起こすか？</td>
<td>1:割り込み有 0:無</td>
<td></td>
</tr>
<tr class="even">
<td>DEFVAL</td>
<td>RW</td>
<td>割り込みの比較値</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>INTCON</td>
<td>RW</td>
<td>割り込みの比較値</td>
<td>1:DEFVAL の値 0:前の値</td>
<td></td>
</tr>
<tr class="even">
<td>IOCON</td>
<td>RW</td>
<td>I2C の設定</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>GPPU</td>
<td>RW</td>
<td>入力ピンのプルアップ (100kΩ) を設定</td>
<td>1:プルアップ有 0:無</td>
<td></td>
</tr>
<tr class="even">
<td>INTF</td>
<td>R</td>
<td>割り込みの状態</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>INTCAP</td>
<td>R</td>
<td>割り込み発生時のキャプチャ値</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>GPIO</td>
<td>RW</td>
<td>入力値/出力値</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>OLAT</td>
<td>RW</td>
<td>出力ラッチ</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="iocon">IOCON</h3>
<table>
<thead>
<tr class="header">
<th>ビットの名前</th>
<th>機能</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>SEQOP</td>
<td>シーケンシャル動作</td>
</tr>
<tr class="even">
<td></td>
<td>（I2C の通信回数に応じて、レジスタアドレスポインタを増分する）</td>
</tr>
<tr class="odd">
<td>DISSLW</td>
<td>SDA 出力スルーレート設定</td>
</tr>
<tr class="even">
<td></td>
<td>（パルスのカーブを急峻にするので基本許可でいい）</td>
</tr>
<tr class="odd">
<td>HAEN</td>
<td>（MCP23S08 のみ）A2,A1 ピンでハードウェアアドレスを変更する</td>
</tr>
<tr class="even">
<td>ODR</td>
<td>INT ピン（割り込み出力）をオープンドレインにする</td>
</tr>
<tr class="odd">
<td>INTPOL</td>
<td>INT ピンの極性</td>
</tr>
</tbody>
</table>
<h2 id="簡単な使い方">簡単な使い方</h2>
<p>割り込みを使わなければ簡単に使えるはずです。</p>
<h3 id="デバイスアドレス">デバイスアドレス</h3>
<p>A2,A1,A0 ピンでアドレスを設定します。</p>
<p>アドレスは 0b0100[a2][a1][a0]になります。</p>
<p>今回は全部 LOW に設定するので、0b0100000。</p>
<h3 id="設定レジスタ">設定レジスタ</h3>
<ol type="1">
<li>GPINTEN = 0 （割り込みは起こさない）</li>
<li>IOCON =
<ol type="1">
<li>SEQOP = 1 （I2C のレジスタアドレスは自動で増分しない）</li>
<li>DISSLW = 0</li>
<li>ODR = 0 （INT ピンは使わない）</li>
<li>INTPOL = 0</li>
</ol></li>
</ol>
<h3 id="出力">出力</h3>
<p>ピンを出力に設定</p>
<p>IODIR = 0</p>
<p>したうえで、</p>
<p>GPIO レジスタに出力値を送るとピンから出力されます。</p>
<h3 id="入力">入力</h3>
<p>ピンを入力に設定</p>
<p>IODIR = 1</p>
<p>入力ピンのプルアップを設定</p>
<p>GPPU = 1</p>
<p>したうえで、</p>
<p>GPIO レジスタの値を読むと入力値を取得できます。</p>
<h2 id="テスト">テスト</h2>
<p>Arduino でテストします。</p>
<p>FPGA でテストします。</p>

    <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="126.444 2.281 589 589"
      style="margin: auto; padding: 0; display: block" onclick="tweet();">
      <circle cx="420.944" cy="296.781" r="294.5" fill="#2daae1" />
      <path
        d="M609.773 179.634c-13.891 6.164-28.811 10.331-44.498 12.204 16.01-9.587 28.275-24.779 34.066-42.86a154.78 154.78 0 0 1-49.209 18.801c-14.125-15.056-34.267-24.456-56.551-24.456-42.773 0-77.462 34.675-77.462 77.473 0 6.064.683 11.98 1.996 17.66-64.389-3.236-121.474-34.079-159.684-80.945-6.672 11.446-10.491 24.754-10.491 38.953 0 26.875 13.679 50.587 34.464 64.477a77.122 77.122 0 0 1-35.097-9.686v.979c0 37.54 26.701 68.842 62.145 75.961-6.511 1.784-13.344 2.716-20.413 2.716-4.998 0-9.847-.473-14.584-1.364 9.859 30.769 38.471 53.166 72.363 53.799-26.515 20.785-59.925 33.175-96.212 33.175-6.25 0-12.427-.373-18.491-1.104 34.291 21.988 75.006 34.824 118.759 34.824 142.496 0 220.428-118.052 220.428-220.428 0-3.361-.074-6.697-.236-10.021a157.855 157.855 0 0 0 38.707-40.158z"
        fill="#fff" />
    </svg>
  </article>
</body>

</html>