---
title: Verilog超入門
---

最近、Verilogに関する質問を受けることが多くなってきたので、まとめておきます。

## FPGAのしくみ

FPGAがなぜ任意の論理回路に姿を変えることができるのか

### 組合回路

ROMは任意の組み合わせ回路になることができます。

例えば、2入力1出力の4bitのROMは、任意の2入力の組み合わせ回路になります。

| アドレス | 値  |
| -------- | --- |
| 0b00     | 0   |
| 0b01     | 1   |
| 0b10     | 1   |
| 0b11     | 1   |

0,1,1,1,1を書き込めば、ORゲートになりますし、0,0,0,1を書き込めば、ANDゲートになります。

### 順序回路

順序回路は、オートマトンで表現できます。

### FPGAの構造

FPGAには、ROM と DFF が大量にあります。

## VerilogをFPGAに書き込むまで

FPGAの正体は、大量のロジックブロックと、それらを接続する大量のスイッチでした。

FPGAに書き込むデータは、

1. LUTに書き込む値
2. スイッチのON/OFF

を、バイナリ化したものになります。

### Synthesis

ネットリストを出力します。

### Place & Route

FPGAのどのLUTにどの組み合わせ回路を割り当てるか、どのFFにどの状態変数を割り当てるか、を設定します。

大きな真理値表を 4 入力ごとに分割し、4 入力真理値表の直列接続に組みなおします。

### Package

ビットストリームを作ります。

## Verilogは状態関係記述言語である

大半の人が、基本的な勘違いをしています。

> Wire Reg が変数

> Reg がフリップフロップ Wire が配線に対応する

### Wire と Reg

**本質的な違いはない！**

System Verilog では、wireとregをまとめて「logic」とすることができます。

## FPGAを使う上での注意

### コンフィグレーション

いままで、FPGAの中には大量のROMが入ってと言いましたが、本当は違います。SRAMです。電源を切ると消えます。

なので、FPGAの隣には不揮発なROMがあり、ここにFPGAのビットストリームが格納されています。
電源を入れたら、ROMのデータをFPGA内部のSRAMに送り、FPGA内部のスイッチ切り替えたり、LUTの値を書き換えたりします。
これをコンフィグレーションといいます。

ビットストリームというのは、FPGAの内部SRAMが数珠つなぎにクソ長シフトレジスタになっていて、そこにデータを流し込むってイメージです。

自分でFPGAを使って回路を組む場合には、コンフィグレーションに注意する必要があります。リセットって難しい。

### FPGAのIO

FPGAも通常のLSIと同じように、IOバッファがあります。
