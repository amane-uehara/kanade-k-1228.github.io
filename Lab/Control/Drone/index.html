<!-- (ฅ^･ω･^ฅ) ﾆｬｰ -->

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja" prefix="og: http://ogp.me/ns#">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-114187773-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag("js", new Date());
    gtag("config", "UA-114187773-1");
  </script>
  <!-- End Google Analytics -->
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="@kanade_k_1228" />
  <link rel="shortcut icon" href="https://avatars.githubusercontent.com/u/54773334" />
      <title>ドローンの制御 | Kanade's Website</title>

  <!-- OGP -->
    <!-- END OGP -->
  <style>
    body {
      margin: 0;
      /* background-color: #fcfeff; */
      /* background-color: #e4f0fc; */
      background-color: #f0f8ff;
      font-size: 16px;
      font-family: Consolas;
      line-height: 1.5;
      color: #202020;
    }

    article {
      display: block;
      margin: 0 auto;
    }

    @media (min-width: 1220px) {
      article {
        width: 1200px;
      }
    }

    @media (max-width: 1219px) {
      article {
        width: 100%;
      }
    }

    h1 {
      display: block;
      margin: 0.5em 0 0.5em 0;
      padding: 8px;
      color: #d64acf;
      font-size: 25px;
      font-weight: bold;
      background-color: #ffccff;
    }

    h2 {
      display: block;
      margin: 0.5em 0 0.5em 0;
      padding: 8px;
      color: #2c8ecf;
      font-size: 20px;
      font-weight: bold;
      background: #bbddff;
    }

    h3 {
      font-weight: bold;
      margin: 1em 0 0.5em 0.5em;
    }

    h4 {
      font-weight: bold;
      margin: 0.5em 0 0.5em 0.7em;
    }

    p {
      margin: 0.5em 0 0.5em 1em;
    }

    small {
      font-size: 10px;
    }

    table {
      margin: 0.5em auto;
      border-collapse: collapse;
    }

    th {
      border: 1px solid;
      padding: 0.3em;
      text-align: center;
      background-color: #e8ffbd;
    }

    td {
      border: 1px solid;
      padding: 0.3em;
      text-align: center;
      background-color: #f0f0ff;
    }

    ul,
    ol {
      margin: 0.5em 0 0.5em 1em;
      padding: 0 0 0 1.5em;
    }

    ul ul,
    ul ul ul,
    ol ol,
    ol ol ol {
      margin: 0;
    }

    blockquote {
      border: 1px solid;
      border-radius: 2px;
      background-color: white;
      margin: 0.5em 1em 0.5em 1em;
    }

    img {
      display: block;
      margin: 0 auto;
      max-width: 100%;
      min-width: 50%;
    }

    header>ul {
      margin: 0.5em 0 0.5em 0;
      padding: 0;
      list-style: none;
      display: flex;
      flex-direction: row;
    }

    header>ul>li {
      width: 25%;
      text-align: center;
    }

    header>ul>li>a {
      display: block;
    }

    div#header-links {
      height: 50px;
      display: flex;
      margin: 0.5em 0 0.5em 0;
      justify-content: space-evenly;
    }

    div#header-links>a {
      text-decoration: none;
    }

    nav {
      border: 1px solid;
      border-radius: 2px;
      background-color: white;
      margin: 0.5em 1em 0.5em 1em;
    }

    nav>ul {
      margin: 0;
    }

    button {
      display: block;
      margin: 0.5em auto;
    }

    iframe {
      display: block;
      margin: 0.5em auto;
    }

    code {
      display: inline-block;
      padding: 1px;
      border-width: 1px;
      border-radius: 5px;
      background: rgba(175, 184, 193, 0.2);
      font-family: "Ricty Diminished", "Ricty", "Myrica M", "Migu 1M", "Source Han Code JP", "SFMono-Regular", "Consolas", "Liberation Mono", "Menlo", "Courier", monospace;
    }
  </style>
  <style>
    a.sourceLine {
      display: inline-block;
      line-height: 1.25;
    }

    a.sourceLine {
      pointer-events: none;
      color: inherit;
      text-decoration: inherit;
    }

    a.sourceLine:empty {
      height: 1.2em;
    }

    .sourceCode {
      overflow: visible;
      font-family: Consolas, Menlo, "Liberation Mono", Courier, monospace;
    }

    code.sourceCode {
      white-space: pre;
      position: relative;
    }

    div.sourceCode {
      margin: 0.5em 1em 0.5em 1em;
    }

    pre.sourceCode {
      margin: 0;
    }

    @media screen {
      div.sourceCode {
        overflow: auto;
      }
    }

    @media print {
      code.sourceCode {
        white-space: pre-wrap;
      }

      a.sourceLine {
        text-indent: -1em;
        padding-left: 1em;
      }
    }

    pre.numberSource a.sourceLine {
      position: relative;
      left: -4em;
    }

    pre.numberSource a.sourceLine::before {
      content: attr(title);
      position: relative;
      left: -1em;
      text-align: right;
      vertical-align: baseline;
      border: none;
      pointer-events: all;
      display: inline-block;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      padding: 0 4px;
      width: 4em;
      color: #aaaaaa;
    }

    pre.numberSource {
      margin-left: 3em;
      border-left: 1px solid #aaaaaa;
      padding-left: 4px;
    }

    div.sourceCode {
      color: rgb(212, 212, 212);
      background-color: rgb(0, 0, 0);
    }

    @media screen {
      a.sourceLine::before {
        text-decoration: underline;
      }
    }

    code span.al {
      color: #ef2929;
    }

    /* Alert */
    code span.an {
      color: #8f5902;
      font-weight: bold;
      font-style: italic;
    }

    /* Annotation */
    code span.at {
      color: #c4a000;
    }

    /* Attribute */
    code span.bn {
      color: rgb(86, 156, 214);
    }

    /* BaseN */
    code span.cf {
      color: rgb(197, 134, 192);
      font-weight: bold;
    }

    /* ControlFlow */
    code span.ch {
      color: #4e9a06;
    }

    /* Char */
    code span.cn {
      color: rgb(181, 206, 168);
    }

    /* Constant */
    code span.co {
      color: rgb(106, 153, 85);
    }

    /* Comment */
    code span.cv {
      color: #8f5902;
      font-weight: bold;
      font-style: italic;
    }

    /* CommentVar */
    code span.do {
      color: #8f5902;
      font-weight: bold;
      font-style: italic;
    }

    /* Documentation */
    code span.dt {
      color: rgb(86, 156, 214);
    }

    /* DataType */
    code span.dv {
      color: rgb(181, 206, 168);
    }

    /* DecVal */
    code span.er {
      color: #a40000;
      font-weight: bold;
    }

    /* Error */
    code span.ex {}

    /* Extension */
    code span.fl {
      color: rgb(181, 206, 168);
    }

    /* Float */
    code span.fu {
      color: rgb(220, 220, 170);
    }

    /* Function */
    code span.im {
      color: rgb(206, 145, 120);
    }

    /* Import */
    code span.in {
      color: #8f5902;
      font-weight: bold;
      font-style: italic;
    }

    /* Information */
    code span.kw {
      color: rgb(78, 201, 176);
      font-weight: bold;
    }

    /* Keyword */
    code span.op {}

    /* Operator */
    code span.ot {
      color: #8f5902;
    }

    /* Other */
    code span.pp {
      color: rgb(197, 134, 192);
    }

    /* Preprocessor */
    code span.sc {
      color: rgb(215, 186, 125);
    }

    /* SpecialChar */
    code span.ss {
      color: #4e9a06;
    }

    /* SpecialString */
    code span.st {
      color: rgb(206, 145, 120);
    }

    /* String */
    code span.va {
      color: rgb(156, 220, 254);
    }

    /* Variable */
    code span.vs {
      color: #4e9a06;
    }

    /* VerbatimString */
    code span.wa {
      color: #8f5902;
      font-weight: bold;
      font-style: italic;
    }

    /* Warning */
  </style>
    <script type="text/javascript" id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    mjx-container[jax="CHTML"][display="true"] {
      display: block;
      text-align: center;
      margin: 0;
    }
  </style>
  <!-- SyntaxHighlight -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/vs2015.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad();
  </script>

  <script>
    function tweet() {
      window.open(
        "https://twitter.com/intent/tweet?via=kanade_k_1228&related=kanade_k_1228&url=" +
        location.href +
        "&text=" +
        "ドローンの制御",
        "_blank"
      );
    }
  </script>
</head>

<body>
  <article>
    <header>
      <ul>
        <li><a href="/">ﾎｰﾑ</a></li>
        <li><a href="/Portfolio/">ﾎﾟﾄﾌｫﾘｵ</a></li>
        <li><a href="/Lab/">研究室</a></li>
        <li><a href="/Blog/">雑記</a></li>
      </ul>
      <div id="header-links">
        <a href="https://twitter.com/kanade_k_1228" target="_blank">
          <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="126.444 2.281 589 589"
            style="margin: 0; padding: 0">
            <circle cx="420.944" cy="296.781" r="294.5" fill="#2daae1" />
            <path
              d="M609.773 179.634c-13.891 6.164-28.811 10.331-44.498 12.204 16.01-9.587 28.275-24.779 34.066-42.86a154.78 154.78 0 0 1-49.209 18.801c-14.125-15.056-34.267-24.456-56.551-24.456-42.773 0-77.462 34.675-77.462 77.473 0 6.064.683 11.98 1.996 17.66-64.389-3.236-121.474-34.079-159.684-80.945-6.672 11.446-10.491 24.754-10.491 38.953 0 26.875 13.679 50.587 34.464 64.477a77.122 77.122 0 0 1-35.097-9.686v.979c0 37.54 26.701 68.842 62.145 75.961-6.511 1.784-13.344 2.716-20.413 2.716-4.998 0-9.847-.473-14.584-1.364 9.859 30.769 38.471 53.166 72.363 53.799-26.515 20.785-59.925 33.175-96.212 33.175-6.25 0-12.427-.373-18.491-1.104 34.291 21.988 75.006 34.824 118.759 34.824 142.496 0 220.428-118.052 220.428-220.428 0-3.361-.074-6.697-.236-10.021a157.855 157.855 0 0 0 38.707-40.158z"
              fill="#fff" />
          </svg>
        </a>
        <a href="https://github.com/kanade-k-1228" target="_blank">
          <svg width="50px" height="50px" viewBox="0 0 1024 1024" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd"
              d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z"
              transform="scale(64)" fill="#1B1F23" />
          </svg>
        </a>
        <a href="https://t.co/E5xtfEQs4A" target="_blank">
          <img src="http://kanade-k-1228.github.io/img/niconico.png" width="50px" height="50px"
            style="border-radius: 50%" /></a>
        <a href="https://www.youtube.com/channel/UCoeuc9-XQ5EpeYSCn4ESpQw" target="_blank">
          <svg width="50px" height="50px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 333333 333333">
            <path
              d="M166667 0c92048 0 166667 74619 166667 166667s-74619 166667-166667 166667S0 258715 0 166667 74619 0 166667 0zm84195 132297s-1678-11849-6843-17052c-6545-6843-13873-6887-17223-7283-24036-1751-60138-1751-60138-1751h-63s-36085 0-60135 1751c-3363 409-10681 437-17223 7283-5168 5203-6811 17052-6811 17052s-1711 13904-1711 27838v13029c0 13905 1709 27837 1709 27837s1678 11849 6811 17061c6542 6843 15139 6621 18977 7350 13761 1314 58457 1710 58457 1710s36133-64 60169-1783c3363-397 10678-438 17223-7284 5168-5202 6843-17065 6843-17065s1711-13904 1711-27837v-13028c-35-13905-1745-27837-1745-27837l-9 9-1-1zm-102010 56674v-48312l46437 24237-46437 24075z"
              fill="red" />
          </svg>
        </a>
      </div>
      <!-- End Top Nav -->
      <!-- Title -->
            <h1 style="margin: 0">ドローンの制御</h1>
            <!-- Date -->
            <!-- Description -->
          </header>

    <!-- TeX Macros -->
    <!-- prettier-ignore -->
    <p style="display: none">
      \[ \newcommand{dn}[3]{\frac{\mathrm{d}^{#3} #1}{\mathrm{d} #2^{#3}}}
      \newcommand{\d}[2]{\frac{\mathrm{d} #1}{\mathrm{d} #2}}
      \newcommand{\dd}[2]{\frac{\mathrm{d}^2 #1}{\mathrm{d} {#2}^2}}
      \newcommand{\ddd}[2]{\frac{\mathrm{d}^3 #1}{\mathrm{d} {#2}^3}}
      \newcommand{\pdn}[3]{\frac{\partial^{#3} #1}{\partial {#2}^{#3}}}
      \newcommand{\pd}[2]{\frac{\partial #1}{\partial #2}}
      \newcommand{\pdd}[2]{\frac{\partial^2 #1}{\partial {#2}^2}}
      \newcommand{\pddd}[2]{\frac{\partial^3 #1}{\partial {#2}^3}}
      \newcommand{\p}{\partial}
      \newcommand{\D}[2]{\frac{\mathrm{D} #1}{\mathrm{D} #2}}
      \newcommand{\Re}{\mathrm{Re}}
      \newcommand{\Im}{\mathrm{Im}}
      \newcommand{\bra}[1]{\left\langle #1 \right|}
      \newcommand{\ket}[1]{\left|#1 \right\rangle}
      \newcommand{\braket}[2]{\left\langle #1 \middle|#2 \right\rangle}
      \newcommand{\inner}[2]{\left\langle #1 ,#2 \right\rangle}
      \newcommand{\l}{\left} \newcommand{\m}{\middle} \newcommand{\r}{\right}
      \newcommand{\f}[2]{\frac{#1}{#2}} \newcommand{\eps}{\varepsilon}
      \newcommand{\ra}{\rightarrow} \newcommand{\F}{\mathcal{F}}
      \newcommand{\L}{\mathcal{L}} \newcommand{\t}{\quad}
      \newcommand{\intinf}{\int_{-\infty}^{+\infty}}
      \newcommand{\R}{\mathcal{R}} \newcommand{\C}{\mathcal{C}}
      \newcommand{\Z}{\mathcal{Z}} \newcommand{\bm}[1]{\boldsymbol{#1}} \]
    </p>

    <!-- Table of Contents -->
        <nav><ul>
<li><a href="#機体系">機体系</a>
<ul>
<li><a href="#運動方程式">運動方程式</a></li>
<li><a href="#観測方程式">観測方程式</a></li>
<li><a href="#状態方程式">状態方程式</a></li>
<li><a href="#制御方式状態の計測">制御方式・状態の計測</a></li>
<li><a href="#ブロック線図">ブロック線図</a></li>
<li><a href="#シュミレーション">シュミレーション</a></li>
<li><a href="#考察">考察</a></li>
</ul></li>
<li><a href="#モーター-プロペラ系">モーター-プロペラ系</a>
<ul>
<li><a href="#モーター">モーター</a></li>
<li><a href="#プロペラ">プロペラ</a></li>
<li><a href="#ブロック線図-1">ブロック線図</a></li>
<li><a href="#制御">制御</a></li>
</ul></li>
</ul></nav>
     <p>2 次元上を動くドローンをある位置に移動させたい。</p>
<p>ドローンの制御を、機体系（推力による速度の制御）と モーター-プロペラ系（推力の制御） に分けて考える。</p>
<p><img src="./img/fig2.drawio.svg" /></p>
<h2 id="機体系">機体系</h2>
<p><img src="./img/fig1.drawio.svg" /></p>
<p>二つのプロペラの推力でドローンを動かす。状態の観測のために 加速度センサ、角速度センサを取り付ける。位置の測定のために、カメラでドローンを撮る。</p>
<table>
<thead>
<tr class="header">
<th>記号の定義</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>定数</td>
<td></td>
</tr>
<tr class="even">
<td><span class="math inline">\(M\)</span></td>
<td>機体重量</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(I\)</span></td>
<td>機体の重心まわりの慣性モーメント</td>
</tr>
<tr class="even">
<td><span class="math inline">\(L\)</span></td>
<td>プロペラの軸間長さ</td>
</tr>
<tr class="odd">
<td>変数</td>
<td></td>
</tr>
<tr class="even">
<td><span class="math inline">\((x,y)\)</span></td>
<td>重心位置</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\theta\)</span></td>
<td>傾き</td>
</tr>
<tr class="even">
<td><span class="math inline">\(f_1,f_2\)</span></td>
<td>プロペラの推力</td>
</tr>
<tr class="odd">
<td><span class="math inline">\((a_x,a_y)\)</span></td>
<td>加速度センサの値</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\omega\)</span></td>
<td>角速度センサの値</td>
</tr>
<tr class="odd">
<td><span class="math inline">\((x_c,y_c)\)</span></td>
<td>カメラから推定した位置</td>
</tr>
</tbody>
</table>
<h3 id="運動方程式">運動方程式</h3>
<p>モーターの反トルク、空気抵抗は無視している。</p>
<p><span class="math display">\[
\begin{aligned}
M\ddot{x} &amp;= -(f_1+f_2)\sin\theta \\
M\ddot{y} &amp;=  (f_1+f_2)\cos\theta - Mg \\
I\ddot{\theta} &amp;= \frac{L}{2}(f_1-f_2)
\end{aligned}
\]</span></p>
<h3 id="観測方程式">観測方程式</h3>
<p>加速度センサの値はセンサに固定された座標系における値であることに注意して、観測方程式を求める。</p>
<p><span class="math display">\[
\begin{aligned}
x_c &amp;= x \\
y_c &amp;= y \\
a_x &amp;=  \ddot{x}\cos\theta + (\ddot{y}-g)\sin\theta \\
a_y &amp;= -\ddot{x}\sin\theta + (\ddot{y}-g)\cos\theta \\
\omega &amp;= \dot{\theta}
\end{aligned}
\]</span></p>
<p>加速度センサはセンサにかかる加速度を計測するが、機体の加速度に比べて重力加速度が十分大きいので、もっぱら鉛直方向を指し示すセンサとして働く。</p>
<h3 id="状態方程式">状態方程式</h3>
<p><span class="math display">\[
\bm{x} =
\begin{bmatrix}
x &amp; \dot{x} &amp; y &amp; \dot{y} &amp; \theta &amp; \dot{\theta}
\end{bmatrix}^T
\quad
\bm{u} = \begin{bmatrix}
f_1 &amp; f_2
\end{bmatrix}^T
\quad
\bm{y} =
\begin{bmatrix}
x_c &amp; y_c &amp; a_x &amp; a_y &amp; \omega
\end{bmatrix}^T
\]</span></p>
<p><span class="math display">\[
\dot{\bm{x}} = \bm{f}(\bm{x},\bm{u}) =
\begin{bmatrix}
x_2 \\
-\frac{1}{M}(u_1+u_2)\sin x_5 \\
x_4 \\
 \frac{1}{M}(u_1+u_2)\cos x_5 - g \\
x_6 \\
\frac{L}{2I}(u_1-u_2)
\end{bmatrix}
\]</span></p>
<p><span class="math display">\[
\bm{y}= \bm{g}(\bm{x},\bm{u}) =
\begin{bmatrix}
x_1 \\
x_3 \\
-\frac{1}{M}(u_1+u_2) \sin x_5 \cos x_5 + \left(\frac{1}{M}(u_1+u_2)\cos x_5 - 2g\right)\sin x_5 \\
 \frac{1}{M}(u_1+u_2) \sin x_5 \sin x_5 + \left(\frac{1}{M}(u_1+u_2)\cos x_5 - 2g\right)\cos x_5 \\
 x_6
\end{bmatrix}
\]</span></p>
<p>平衡点（ホバリング状態） <span class="math inline">\(\bm{x}_0=\bm{0},\bm{u}_0=\left(\frac{Mg}{2},\frac{Mg}{2}\right)\)</span> まわりで一次近似して線形な状態方程式を求めると、</p>
<p><span class="math display">\[
\dot{\bm{x}} =
\begin{bmatrix}
0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
  &amp; 0 &amp; 0 &amp; 0 &amp;-g &amp; 0 \\
  &amp;   &amp; 0 &amp; 1 &amp; 0 &amp; 0 \\
  &amp;   &amp;   &amp; 0 &amp; 0 &amp; 0 \\
  &amp;   &amp;   &amp;   &amp; 0 &amp; 1 \\
  &amp;   &amp;   &amp;   &amp;   &amp; 0 \\
\end{bmatrix}
\bm{x}
+
\begin{bmatrix}
0 &amp; 0 \\
0 &amp; 0 \\
0 &amp; 0 \\
\frac{1}{M} &amp; \frac{1}{M} \\
0 &amp; 0 \\
\frac{L}{2I} &amp; -\frac{L}{2I} \\
\end{bmatrix}
(\bm{u}-\bm{u}_0)
\]</span></p>
<p><span class="math display">\[
\bm{y} =
\begin{bmatrix}
1 &amp; 0 &amp; 0 &amp; 0 &amp;    &amp;   \\
0 &amp; 0 &amp; 1 &amp; 0 &amp;    &amp;   \\
  &amp;   &amp;   &amp;   &amp;-2g &amp;   \\
  &amp;   &amp;   &amp;   &amp; 2g &amp;   \\
  &amp;   &amp;   &amp;   &amp;    &amp; 1
\end{bmatrix}
\bm{x}
+
\begin{bmatrix}
0 &amp; 0 \\
0 &amp; 0 \\
0 &amp; 0 \\
\frac{1}{M} &amp; \frac{1}{M} \\
0 &amp; 0
\end{bmatrix}
(\bm{u}-\bm{u}_0)
\]</span></p>
<h3 id="制御方式状態の計測">制御方式・状態の計測</h3>
<p>Matlab を用いて可制御・可観測を確認した。</p>
<pre><code>SS = ss(A,B,C,D)
rank(ctrb(SS)) == length(A)
rank(obsv(SS)) == length(A)</code></pre>
<p>制御方式は最適制御とし、フィードバックゲインを以下の Matlab コードで求めた。</p>
<pre><code>Q = diag([80,10,80,10,10,30]);
R = diag([50,50]);
[Kreg,~,Ef] = lqr(A,B,Q,R);</code></pre>
<p>双対システムのフィードバックゲインを求め、オブザーバゲインとした。</p>
<pre><code>S = diag([64,100,63,100,100,100]);
T = diag([10,10,10,10,10]);
[Lregt,~,Eo] = lqr(A&#39;,C&#39;,S,T);
Lreg = Lregt&#39;;</code></pre>
<h3 id="ブロック線図">ブロック線図</h3>
<p><img src="./img/block.png" /></p>
<h3 id="シュミレーション">シュミレーション</h3>
<p>パラメタを <span class="math inline">\(M=0.2 \mathrm{kg},\,L=0.4 \mathrm{m},\, I=0.008\mathrm{kgm^2}\)</span> とする。ホバリング推力は <span class="math inline">\(u_0=\frac{Mg}{2}=0.98\mathrm{N}\)</span> である。</p>
<p>初期位置を <span class="math inline">\((x,y,\theta)=(-1,-1,10^\circ)\)</span> としたときのシュミレーション結果を示す。</p>
<p><img src="./img/path_1-1-10.png" /></p>
<p><img src="./img/time_1-1-10.png" /></p>
<p>また、初期位置を <span class="math inline">\((x,y,\theta)=(-3,-3,10^\circ)\)</span> としたときのシュミレーション結果は</p>
<p><img src="./img/path_3-3-10.png" /></p>
<h3 id="考察">考察</h3>
<ul>
<li>最適制御の評価関数を決めるのに苦労した。各重みの変化に対して根軌跡をプロットすれば直観的に決められると考えられる。</li>
<li>x 方向に大きく移動すると大きく傾いている。線形近似した運動方程式では、x 方向の加速度を増すために傾きを大きくするしかない。さらに、元の非線形な運動方程式では、傾きによる x 方向の加速度の増加が、線形の場合よりも抑えられるため、現実のドローンはシュミレーションよりも大きな傾きとなることが考えられる。傾きが大きくなると、今回の制御の線形近似から外れ、さらに傾きが増大する危険性がある。x 方向に大きく動かさないようにする必要がある。</li>
</ul>
<h2 id="モーター-プロペラ系">モーター-プロペラ系</h2>
<h3 id="モーター">モーター</h3>
<table>
<thead>
<tr class="header">
<th>記号</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>定数</td>
<td></td>
</tr>
<tr class="even">
<td><span class="math inline">\(K_T\)</span></td>
<td>トルク定数</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(K_E\)</span></td>
<td>逆起電力定数</td>
</tr>
<tr class="even">
<td><span class="math inline">\(R\)</span></td>
<td>巻線抵抗</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(L\)</span></td>
<td>インダクタンス</td>
</tr>
<tr class="even">
<td>変数</td>
<td></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(e\)</span></td>
<td>逆起電力</td>
</tr>
<tr class="even">
<td><span class="math inline">\(E\)</span></td>
<td>入力電圧</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(I\)</span></td>
<td>電流</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\omega\)</span></td>
<td>角速度</td>
</tr>
</tbody>
</table>
<p>キルヒホッフの法則より</p>
<p><span class="math display">\[
E-e=RI+L\dot{I}
\]</span></p>
<p>逆起電力は</p>
<p><span class="math display">\[
e=K_E\omega
\]</span></p>
<p>トルクは</p>
<p><span class="math display">\[
T=K_TI
\]</span></p>
<h3 id="プロペラ">プロペラ</h3>
<table>
<thead>
<tr class="header">
<th>記号</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>定数</td>
<td></td>
</tr>
<tr class="even">
<td><span class="math inline">\(\rho\)</span></td>
<td>空気密度</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(D\)</span></td>
<td>直径</td>
</tr>
<tr class="even">
<td><span class="math inline">\(I_R\)</span></td>
<td>慣性モーメント</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\beta\)</span></td>
<td>羽根角</td>
</tr>
<tr class="even">
<td>変数</td>
<td></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(V\)</span></td>
<td>対気速度</td>
</tr>
<tr class="even">
<td><span class="math inline">\(n\)</span></td>
<td>回転数</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\omega\)</span></td>
<td>角速度</td>
</tr>
<tr class="even">
<td><span class="math inline">\(J\)</span></td>
<td>進行率</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(C_F\)</span></td>
<td>プロペラ推力係数</td>
</tr>
<tr class="even">
<td><span class="math inline">\(C_Q\)</span></td>
<td>プロペラ反トルク係数</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(T\)</span></td>
<td>入力トルク</td>
</tr>
<tr class="even">
<td><span class="math inline">\(F\)</span></td>
<td>推力</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(Q\)</span></td>
<td>反トルク</td>
</tr>
</tbody>
</table>
<p>回転の運動方程式は</p>
<p><span class="math display">\[
I_R\dot{\omega}=T-Q
\]</span></p>
<p>推力と反トルクは の関数</p>
<p><span class="math display">\[
\begin{aligned}
  F &amp;= C_F\rho D^4 n^2 \\
  Q &amp;= C_Q\rho D^5 n^2
\end{aligned}
\]</span></p>
<p><span class="math inline">\(C_F,C_Q\)</span> は一般に 羽根角 <span class="math inline">\(\beta\)</span> と進行率 <span class="math inline">\(J=\frac{V}{nD}\)</span> の非線形な関数であり、風洞実験から計測する。今回は対気速度がプロペラの回転数に対して十分小さい領域で動作するので、<span class="math inline">\(C_F,C_Q\)</span>は定数とする。</p>
<p>定数 <span class="math inline">\(K_F,K_Q\)</span> を</p>
<p><span class="math display">\[
\begin{aligned}
  K_F &amp;:= \frac{C_F\rho D^4}{4\pi^2} \\
  K_Q &amp;:= \frac{C_Q\rho D^5}{4\pi^2}
\end{aligned}
\]</span></p>
<p>とすると、</p>
<p><span class="math display">\[
\begin{aligned}
  F &amp;= K_F\omega^2\\
  Q &amp;= K_Q\omega^2
\end{aligned}
\]</span></p>
<p>参考：航空工学講座６　プロペラ（日本航空技術協会）</p>
<h3 id="ブロック線図-1">ブロック線図</h3>
<p>プロペラとモーターを結合した系のブロック線図は以下のようになる。</p>
<p><img src="./img/fig5.drawio.svg" /></p>
<h3 id="制御">制御</h3>
<p>センサとして回転軸にエンコーダを取り付け回転数を計測する。推力指令に対して追従する制御を行う。ホバリング推力前後で特性が良くなるようにゲインを調整する。</p>
<p><img src="./img/fig6.drawio.svg" /></p>

    <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="126.444 2.281 589 589"
      style="margin: auto; padding: 0; display: block" onclick="tweet();">
      <circle cx="420.944" cy="296.781" r="294.5" fill="#2daae1" />
      <path
        d="M609.773 179.634c-13.891 6.164-28.811 10.331-44.498 12.204 16.01-9.587 28.275-24.779 34.066-42.86a154.78 154.78 0 0 1-49.209 18.801c-14.125-15.056-34.267-24.456-56.551-24.456-42.773 0-77.462 34.675-77.462 77.473 0 6.064.683 11.98 1.996 17.66-64.389-3.236-121.474-34.079-159.684-80.945-6.672 11.446-10.491 24.754-10.491 38.953 0 26.875 13.679 50.587 34.464 64.477a77.122 77.122 0 0 1-35.097-9.686v.979c0 37.54 26.701 68.842 62.145 75.961-6.511 1.784-13.344 2.716-20.413 2.716-4.998 0-9.847-.473-14.584-1.364 9.859 30.769 38.471 53.166 72.363 53.799-26.515 20.785-59.925 33.175-96.212 33.175-6.25 0-12.427-.373-18.491-1.104 34.291 21.988 75.006 34.824 118.759 34.824 142.496 0 220.428-118.052 220.428-220.428 0-3.361-.074-6.697-.236-10.021a157.855 157.855 0 0 0 38.707-40.158z"
        fill="#fff" />
    </svg>
  </article>
</body>

</html>