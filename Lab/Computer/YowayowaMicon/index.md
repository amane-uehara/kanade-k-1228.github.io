---
title: 自作マイコン、よわよわマイコン
---

## 目標

1. 簡素な CPU
   - リレーコンピュータのアーキテクチャをベースにした、単純なアーキと単純な機械語
2. 充実したペリフェラル
   - 割り込み
   - DMA
   - 入出力：GPIO、ADC、DAC、PWM
   - 通信：I2C、SPI、Serial

## 仕様

### VFC/PFC アーキテクチャ

メモリまたはレジスタに記憶されている値の移動と演算処理を行う部分（Value Flow Controller, VFC）と、

プログラムの制御を行う部分（Program Flow Controller, PFC）からなるアーキテクチャ。

### 命令セット

リレーコンピュータの、4 命令 ISA をベースにする。

関数呼び出しができないので、スタックを実装する。

### アセンブラ・コンパイラ

## アーキテクチャ

### アドレスマップ

|      |       |      |                  |
| ---- | ----- | ---- | ---------------- |
| 0000 | x0    | zero | ゼロ固定         |
| 0001 | x1    | ra   | 戻りアドレス     |
| 0002 | x2    | sp   | スタックポインタ |
| 0003 | x3    |      |                  |
| 0004 | x4    |      |                  |
| 0005 | x5    |      |                  |
| 0006 | x6    |      |                  |
| 0007 | x7    |      |                  |
| 0008 |       |      |                  |
| 0009 |       |      |                  |
| 000A |       |      |                  |
| 000B |       |      |                  |
| 000C |       |      |                  |
| 000D |       |      |                  |
| 000E |       |      |                  |
| 000F |       |      |                  |
| 0010 | alu0  | sl   |                  |
| 0011 | alu1  | sr   |                  |
| 0012 | alu2  | add  |                  |
| 0013 | alu3  | sub  |                  |
| 0014 | alu4  | xor  |                  |
| 0015 | alu5  | or   |                  |
| 0016 | alu6  | and  |                  |
| 0017 | alu7  | not  |                  |
| 0018 | alu8  |      |                  |
| 0019 | alu9  |      |                  |
| 001A | aluA  |      |                  |
| 001B | aluB  |      |                  |
| 001C | aluC  |      |                  |
| 001D | aluD  |      |                  |
| 001E | aluE  |      |                  |
| 001F | aluF  |      |                  |
| 0020 | gpio0 |      |                  |
| 0021 | gpio1 |      |                  |
| 0022 | gpio2 |      |                  |
| 0023 | gpio3 |      |                  |
| 0024 | gpio4 |      |                  |
| 0025 | gpio5 |      |                  |
| 0026 | gpio6 |      |                  |
| 0027 | gpio7 |      |                  |
| 0028 | adc0  |      |                  |
| 0029 | adc1  |      |                  |
| 002A | adc2  |      |                  |
| 002B | adc3  |      |                  |
| 002C | dac0  |      |                  |
| 002D | dac1  |      |                  |
| 002E | dac2  |      |                  |
| 002F | dac3  |      |                  |
| 0030 | pwm0  |      |                  |
| 0031 | pwm1  |      |                  |
| 0032 | pwm2  |      |                  |
| 0033 | pwm3  |      |                  |
| 0034 | pwm4  |      |                  |
| 0035 | pwm5  |      |                  |
| 0036 | pwm6  |      |                  |
| 0037 | pwm7  |      |                  |
| 0038 | I2C   |      |                  |
| 0039 | I2C   |      |                  |
| 003A | I2C   |      |                  |
| 003B | I2C   |      |                  |
| 003C | SPI   |      |                  |
| 003D | SPI   |      |                  |
| 003E | SPI   |      |                  |
| 003F | SPI   |      |                  |
|      |       |      |                  |
