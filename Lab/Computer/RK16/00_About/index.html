<!-- (ฅ^･ω･^ฅ) ﾆｬｰ -->

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja" prefix="og: http://ogp.me/ns#">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-114187773-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag("js", new Date());
    gtag("config", "UA-114187773-1");
  </script>
  <!-- End Google Analytics -->
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="@kanade_k_1228" />
  <link rel="shortcut icon" href="https://avatars.githubusercontent.com/u/54773334" />
    <meta name="dcterms.date" content="2022-09-23" />
      <title>マイコンを作りたい！ | Kanade's Website</title>

  <!-- OGP -->
    <!-- END OGP -->
  <style>
    body {
      margin: 0;
      /* background-color: #fcfeff; */
      /* background-color: #e4f0fc; */
      background-color: #f0f8ff;
      font-size: 16px;
      font-family: Consolas, 'Courier New', monospace,
        メイリオ, Meiryo, 游ゴシック体, "Yu Gothic", YuGothic,
        "ヒラギノ角ゴシック Pro", "Hiragino Kaku Gothic Pro", Osaka,
        "ＭＳ Ｐゴシック", "MS PGothic", sans-serif;
      line-height: 1.5;
      color: #202020;
    }

    article {
      display: block;
      margin: 0 auto;
    }

    @media (min-width: 1220px) {
      article {
        width: 1200px;
      }
    }

    @media (max-width: 1219px) {
      article {
        width: 100%;
      }
    }

    h1 {
      display: block;
      margin: 0.5em 0 0.5em 0;
      padding: 8px;
      color: #d64acf;
      font-size: 25px;
      font-weight: bold;
      background-color: #ffccff;
    }

    h2 {
      display: block;
      margin: 0.5em 0 0.5em 0;
      padding: 8px;
      color: #2c8ecf;
      font-size: 20px;
      font-weight: bold;
      background: #bbddff;
    }

    h3 {
      font-weight: bold;
      margin: 1em 0 0.5em 0.5em;
    }

    h4 {
      font-weight: bold;
      margin: 0.5em 0 0.5em 0.7em;
    }

    p {
      margin: 0.5em 0 0.5em 1em;
    }

    small {
      font-size: 10px;
    }

    table {
      margin: 0.5em auto;
      border-collapse: collapse;
    }

    th {
      border: 1px solid;
      padding: 0.3em;
      text-align: center;
      background-color: #e8ffbd;
    }

    td {
      border: 1px solid;
      padding: 0.3em;
      text-align: center;
      background-color: #f0f0ff;
    }

    ul,
    ol {
      margin: 0.5em 0 0.5em 1em;
      padding: 0 0 0 1.5em;
    }

    ul ul,
    ul ul ul,
    ol ol,
    ol ol ol {
      margin: 0;
    }

    blockquote {
      border: 1px solid;
      border-radius: 2px;
      background-color: white;
      margin: 0.5em 1em 0.5em 1em;
    }

    img {
      display: block;
      margin: 0 auto;
      max-width: 100%;
      min-width: 50%;
    }

    header>ul {
      margin: 0.5em 0 0.5em 0;
      padding: 0;
      list-style: none;
      display: flex;
      flex-direction: row;
    }

    header>ul>li {
      width: 25%;
      text-align: center;
    }

    header>ul>li>a {
      display: block;
    }

    div#header-links {
      height: 50px;
      display: flex;
      margin: 0.5em 0 0.5em 0;
      justify-content: space-evenly;
    }

    div#header-links>a {
      text-decoration: none;
    }

    nav {
      border: 1px solid;
      border-radius: 2px;
      background-color: white;
      margin: 0.5em 1em 0.5em 1em;
    }

    nav>ul {
      margin: 0;
    }

    button {
      display: block;
      margin: 0.5em auto;
    }

    iframe {
      display: block;
      margin: 0.5em auto;
    }

    code {
      display: inline-block;
      padding: 1px;
      border-width: 1px;
      border-radius: 5px;
      background: rgba(175, 184, 193, 0.2);
      font-family: "Ricty Diminished", "Ricty", "Myrica M", "Migu 1M", "Source Han Code JP", "SFMono-Regular", "Consolas", "Liberation Mono", "Menlo", "Courier", monospace;
    }
  </style>
  <style>
    a.sourceLine {
      display: inline-block;
      line-height: 1.25;
    }

    a.sourceLine {
      pointer-events: none;
      color: inherit;
      text-decoration: inherit;
    }

    a.sourceLine:empty {
      height: 1.2em;
    }

    .sourceCode {
      overflow: visible;
      font-family: Consolas, Menlo, "Liberation Mono", Courier, monospace;
    }

    code.sourceCode {
      white-space: pre;
      position: relative;
    }

    div.sourceCode {
      margin: 0.5em 1em 0.5em 1em;
    }

    pre.sourceCode {
      margin: 0;
    }

    @media screen {
      div.sourceCode {
        overflow: auto;
      }
    }

    @media print {
      code.sourceCode {
        white-space: pre-wrap;
      }

      a.sourceLine {
        text-indent: -1em;
        padding-left: 1em;
      }
    }

    pre.numberSource a.sourceLine {
      position: relative;
      left: -4em;
    }

    pre.numberSource a.sourceLine::before {
      content: attr(title);
      position: relative;
      left: -1em;
      text-align: right;
      vertical-align: baseline;
      border: none;
      pointer-events: all;
      display: inline-block;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      padding: 0 4px;
      width: 4em;
      color: #aaaaaa;
    }

    pre.numberSource {
      margin-left: 3em;
      border-left: 1px solid #aaaaaa;
      padding-left: 4px;
    }

    div.sourceCode {
      color: rgb(212, 212, 212);
      background-color: rgb(0, 0, 0);
    }

    @media screen {
      a.sourceLine::before {
        text-decoration: underline;
      }
    }

    code span.al {
      color: #ef2929;
    }

    /* Alert */
    code span.an {
      color: #8f5902;
      font-weight: bold;
      font-style: italic;
    }

    /* Annotation */
    code span.at {
      color: #c4a000;
    }

    /* Attribute */
    code span.bn {
      color: rgb(86, 156, 214);
    }

    /* BaseN */
    code span.cf {
      color: rgb(197, 134, 192);
      font-weight: bold;
    }

    /* ControlFlow */
    code span.ch {
      color: #4e9a06;
    }

    /* Char */
    code span.cn {
      color: rgb(181, 206, 168);
    }

    /* Constant */
    code span.co {
      color: rgb(106, 153, 85);
    }

    /* Comment */
    code span.cv {
      color: #8f5902;
      font-weight: bold;
      font-style: italic;
    }

    /* CommentVar */
    code span.do {
      color: #8f5902;
      font-weight: bold;
      font-style: italic;
    }

    /* Documentation */
    code span.dt {
      color: rgb(86, 156, 214);
    }

    /* DataType */
    code span.dv {
      color: rgb(181, 206, 168);
    }

    /* DecVal */
    code span.er {
      color: #a40000;
      font-weight: bold;
    }

    /* Error */
    code span.ex {}

    /* Extension */
    code span.fl {
      color: rgb(181, 206, 168);
    }

    /* Float */
    code span.fu {
      color: rgb(220, 220, 170);
    }

    /* Function */
    code span.im {
      color: rgb(206, 145, 120);
    }

    /* Import */
    code span.in {
      color: #8f5902;
      font-weight: bold;
      font-style: italic;
    }

    /* Information */
    code span.kw {
      color: rgb(78, 201, 176);
      font-weight: bold;
    }

    /* Keyword */
    code span.op {}

    /* Operator */
    code span.ot {
      color: #8f5902;
    }

    /* Other */
    code span.pp {
      color: rgb(197, 134, 192);
    }

    /* Preprocessor */
    code span.sc {
      color: rgb(215, 186, 125);
    }

    /* SpecialChar */
    code span.ss {
      color: #4e9a06;
    }

    /* SpecialString */
    code span.st {
      color: rgb(206, 145, 120);
    }

    /* String */
    code span.va {
      color: rgb(156, 220, 254);
    }

    /* Variable */
    code span.vs {
      color: #4e9a06;
    }

    /* VerbatimString */
    code span.wa {
      color: #8f5902;
      font-weight: bold;
      font-style: italic;
    }

    /* Warning */
  </style>
    <script type="text/javascript" id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    mjx-container[jax="CHTML"][display="true"] {
      display: block;
      text-align: center;
      margin: 0;
    }
  </style>
  <!-- SyntaxHighlight -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/vs2015.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad();
  </script>

  <script>
    function tweet() {
      window.open(
        "https://twitter.com/intent/tweet?via=kanade_k_1228&related=kanade_k_1228&url=" +
        location.href +
        "&text=" +
        "マイコンを作りたい！",
        "_blank"
      );
    }
  </script>
</head>

<body>
  <article>
    <header>
      <ul>
        <li><a href="/">ﾎｰﾑ</a></li>
        <li><a href="/Portfolio/">ﾎﾟﾄﾌｫﾘｵ</a></li>
        <li><a href="/Lab/">研究室</a></li>
        <li><a href="/Blog/">雑記</a></li>
      </ul>
      <div id="header-links">
        <a href="https://twitter.com/kanade_k_1228" target="_blank">
          <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="126.444 2.281 589 589"
            style="margin: 0; padding: 0">
            <circle cx="420.944" cy="296.781" r="294.5" fill="#2daae1" />
            <path
              d="M609.773 179.634c-13.891 6.164-28.811 10.331-44.498 12.204 16.01-9.587 28.275-24.779 34.066-42.86a154.78 154.78 0 0 1-49.209 18.801c-14.125-15.056-34.267-24.456-56.551-24.456-42.773 0-77.462 34.675-77.462 77.473 0 6.064.683 11.98 1.996 17.66-64.389-3.236-121.474-34.079-159.684-80.945-6.672 11.446-10.491 24.754-10.491 38.953 0 26.875 13.679 50.587 34.464 64.477a77.122 77.122 0 0 1-35.097-9.686v.979c0 37.54 26.701 68.842 62.145 75.961-6.511 1.784-13.344 2.716-20.413 2.716-4.998 0-9.847-.473-14.584-1.364 9.859 30.769 38.471 53.166 72.363 53.799-26.515 20.785-59.925 33.175-96.212 33.175-6.25 0-12.427-.373-18.491-1.104 34.291 21.988 75.006 34.824 118.759 34.824 142.496 0 220.428-118.052 220.428-220.428 0-3.361-.074-6.697-.236-10.021a157.855 157.855 0 0 0 38.707-40.158z"
              fill="#fff" />
          </svg>
        </a>
        <a href="https://github.com/kanade-k-1228" target="_blank">
          <svg width="50px" height="50px" viewBox="0 0 1024 1024" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd"
              d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z"
              transform="scale(64)" fill="#1B1F23" />
          </svg>
        </a>
        <a href="https://t.co/E5xtfEQs4A" target="_blank">
          <img src="http://kanade-k-1228.github.io/img/niconico.png" width="50px" height="50px"
            style="border-radius: 50%" /></a>
        <a href="https://www.youtube.com/channel/UCoeuc9-XQ5EpeYSCn4ESpQw" target="_blank">
          <svg width="50px" height="50px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 333333 333333">
            <path
              d="M166667 0c92048 0 166667 74619 166667 166667s-74619 166667-166667 166667S0 258715 0 166667 74619 0 166667 0zm84195 132297s-1678-11849-6843-17052c-6545-6843-13873-6887-17223-7283-24036-1751-60138-1751-60138-1751h-63s-36085 0-60135 1751c-3363 409-10681 437-17223 7283-5168 5203-6811 17052-6811 17052s-1711 13904-1711 27838v13029c0 13905 1709 27837 1709 27837s1678 11849 6811 17061c6542 6843 15139 6621 18977 7350 13761 1314 58457 1710 58457 1710s36133-64 60169-1783c3363-397 10678-438 17223-7284 5168-5202 6843-17065 6843-17065s1711-13904 1711-27837v-13028c-35-13905-1745-27837-1745-27837l-9 9-1-1zm-102010 56674v-48312l46437 24237-46437 24075z"
              fill="red" />
          </svg>
        </a>
      </div>
      <!-- End Top Nav -->
      <!-- Title -->
            <h1 style="margin: 0">マイコンを作りたい！</h1>
            <!-- Date -->
            <p align="right">2022-09-23</p>
            <!-- Description -->
          </header>

    <!-- TeX Macros -->
    <!-- prettier-ignore -->
    <p style="display: none">
      \[ \newcommand{dn}[3]{\frac{\mathrm{d}^{#3} #1}{\mathrm{d} #2^{#3}}}
      \newcommand{\d}[2]{\frac{\mathrm{d} #1}{\mathrm{d} #2}}
      \newcommand{\dd}[2]{\frac{\mathrm{d}^2 #1}{\mathrm{d} {#2}^2}}
      \newcommand{\ddd}[2]{\frac{\mathrm{d}^3 #1}{\mathrm{d} {#2}^3}}
      \newcommand{\pdn}[3]{\frac{\partial^{#3} #1}{\partial {#2}^{#3}}}
      \newcommand{\pd}[2]{\frac{\partial #1}{\partial #2}}
      \newcommand{\pdd}[2]{\frac{\partial^2 #1}{\partial {#2}^2}}
      \newcommand{\pddd}[2]{\frac{\partial^3 #1}{\partial {#2}^3}}
      \newcommand{\p}{\partial}
      \newcommand{\D}[2]{\frac{\mathrm{D} #1}{\mathrm{D} #2}}
      \newcommand{\Re}{\mathrm{Re}}
      \newcommand{\Im}{\mathrm{Im}}
      \newcommand{\bra}[1]{\left\langle #1 \right|}
      \newcommand{\ket}[1]{\left|#1 \right\rangle}
      \newcommand{\braket}[2]{\left\langle #1 \middle|#2 \right\rangle}
      \newcommand{\inner}[2]{\left\langle #1 ,#2 \right\rangle}
      \newcommand{\l}{\left} \newcommand{\m}{\middle} \newcommand{\r}{\right}
      \newcommand{\f}[2]{\frac{#1}{#2}} \newcommand{\eps}{\varepsilon}
      \newcommand{\ra}{\rightarrow} \newcommand{\F}{\mathcal{F}}
      \newcommand{\L}{\mathcal{L}} \newcommand{\t}{\quad}
      \newcommand{\intinf}{\int_{-\infty}^{+\infty}}
      \newcommand{\R}{\mathcal{R}} \newcommand{\C}{\mathcal{C}}
      \newcommand{\Z}{\mathcal{Z}} \newcommand{\bm}[1]{\boldsymbol{#1}} \]
    </p>

    <!-- Table of Contents -->
        <nav><ul>
<li><a href="#目標野望">目標・野望</a>
<ul>
<li><a href="#ロジック-ic-で作る">1. ロジック IC で作る</a></li>
<li><a href="#全部自作">2. 全部自作。</a></li>
<li><a href="#実用性">3. 実用性</a></li>
<li><a href="#柔軟な開発">4. 柔軟な開発</a></li>
</ul></li>
<li><a href="#作るもの">作るもの</a>
<ul>
<li><a href="#cpu">CPU</a></li>
<li><a href="#アセンブラ">アセンブラ</a></li>
<li><a href="#コンパイラ">コンパイラ</a></li>
<li><a href="#エミュレータ">エミュレータ</a></li>
<li><a href="#os">OS</a></li>
<li><a href="#ハードウェア">ハードウェア</a></li>
<li><a href="#ライタ">ライタ</a></li>
</ul></li>
<li><a href="#将来的に作りたいもの">将来的に作りたいもの</a>
<ul>
<li><a href="#llvm-バックエンド">LLVM バックエンド</a></li>
<li><a href="#デバッガ">デバッガ</a></li>
<li><a href="#開発環境">開発環境</a></li>
</ul></li>
<li><a href="#開発フロー">開発フロー</a></li>
</ul></nav>
     <p>MFT2022、お疲れ様でした。 リレーコンピュータを構想してから 5 年、なんとか完成することができました。 ということで、ようやくトランジスタ縛りから開放されたので、トランジスタで CPU を作って、OS を動かしていきます。 来年の MFT2023 に出せたらいいな…？</p>
<h2 id="目標野望">目標・野望</h2>
<blockquote>
<p>ロマンと実用性の両立！楽しい！感動できる！</p>
</blockquote>
<h3 id="ロジック-ic-で作る">1. ロジック IC で作る</h3>
<p>できるだけスルーホールのロジック IC を使って作る。</p>
<h3 id="全部自作">2. 全部自作。</h3>
<p>回路から、アセンブラ、コンパイラ、OS を全て手作り。</p>
<h3 id="実用性">3. 実用性</h3>
<p>いろいろ遊べる。機能がたくさん。</p>
<ul>
<li>割り込み</li>
<li>DMA</li>
<li>VGA 映像出力</li>
<li>キーボード入力</li>
<li>GPIO、ADC、DAC、PWM</li>
<li>I2C、SPI、Serial</li>
</ul>
<h3 id="柔軟な開発">4. 柔軟な開発</h3>
<p>リレーコンピュータが5年もかかったのは、何回か大幅な設計変更をしたから。 だいぶ寄り道してたのもあるけど。 回路基板を実装した後に設計変更するのはかなり萎える。</p>
<p>今回のマイコン開発ではエミュレータとFPGAを使って†アジャイル開発†する。 たとえば、OSを作る中でCPUの仕様を変えたくなったらエミュレータを書き換える。 最終的に仕様が決まってからロジックICとして実装する。</p>
<h2 id="作るもの">作るもの</h2>
<h3 id="cpu">CPU</h3>
<p>RISC-V っぽい CPU。</p>
<h3 id="アセンブラ">アセンブラ</h3>
<p>アセンブリと機械語を一対一に変換するだではなく、変数・定数にラベルを割り当てて、生でアセンブリを書く負担を減らします。</p>
<h3 id="コンパイラ">コンパイラ</h3>
<p>C言語っぽい高級言語を自作して、そのコンパイラを作ります。</p>
<h3 id="エミュレータ">エミュレータ</h3>
<p>機械語コードを読んで CPU をエミュレートします。</p>
<h3 id="os">OS</h3>
<p>リアルタイム OS を作ります。</p>
<h3 id="ハードウェア">ハードウェア</h3>
<p>ロジック IC で CPU を組みます。</p>
<h3 id="ライタ">ライタ</h3>
<p>パソコンから ROM に機械語コードを書き込みます。</p>
<h2 id="将来的に作りたいもの">将来的に作りたいもの</h2>
<h3 id="llvm-バックエンド">LLVM バックエンド</h3>
<blockquote>
<p>LLVM 神「力が…欲しいか…」</p>
</blockquote>
<p>LLVM の力を借りて、C 言語が完全にサポートされたコンパイラを作ります。</p>
<h3 id="デバッガ">デバッガ</h3>
<p>パソコン側から、ステップ実行したり、ROM の値を読んだりできるようにします。</p>
<h3 id="開発環境">開発環境</h3>
<p>VSCode の拡張機能として、フォーマッタ、シンタックスハイライトを実装します。 VSCode のデバッガインターフェースを使って実行＆デバッグできるようにします。</p>
<h2 id="開発フロー">開発フロー</h2>
<p><img src="./img/devflow.dio.svg" /></p>

    <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="126.444 2.281 589 589"
      style="margin: auto; padding: 0; display: block" onclick="tweet();">
      <circle cx="420.944" cy="296.781" r="294.5" fill="#2daae1" />
      <path
        d="M609.773 179.634c-13.891 6.164-28.811 10.331-44.498 12.204 16.01-9.587 28.275-24.779 34.066-42.86a154.78 154.78 0 0 1-49.209 18.801c-14.125-15.056-34.267-24.456-56.551-24.456-42.773 0-77.462 34.675-77.462 77.473 0 6.064.683 11.98 1.996 17.66-64.389-3.236-121.474-34.079-159.684-80.945-6.672 11.446-10.491 24.754-10.491 38.953 0 26.875 13.679 50.587 34.464 64.477a77.122 77.122 0 0 1-35.097-9.686v.979c0 37.54 26.701 68.842 62.145 75.961-6.511 1.784-13.344 2.716-20.413 2.716-4.998 0-9.847-.473-14.584-1.364 9.859 30.769 38.471 53.166 72.363 53.799-26.515 20.785-59.925 33.175-96.212 33.175-6.25 0-12.427-.373-18.491-1.104 34.291 21.988 75.006 34.824 118.759 34.824 142.496 0 220.428-118.052 220.428-220.428 0-3.361-.074-6.697-.236-10.021a157.855 157.855 0 0 0 38.707-40.158z"
        fill="#fff" />
    </svg>
  </article>
</body>

</html>