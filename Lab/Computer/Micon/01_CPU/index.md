---
title: マイコン用CPU、RISC-K
---

## VFC/PFC アーキテクチャ

記憶されている値の移動と演算処理を行う Value Flow Controller (VFC) と、

プログラムの制御を行う部分 Program Flow Controller (PFC) からなるアーキテクチャ。

![](./img/arch.dio.svg)

## 命令セット

リレーコンピュータの、4 命令 ISA をベースにする。

関数呼び出しができないので、スタックを実装する。

### サブルーチン

### 割り込み

## 回路詳細

### メモリマップ

| Addr | Function       |
| ---- | -------------- |
| 0000 | 汎用レジスタ   |
| 0010 | 演算レジスタ   |
| 0020 | 入出力レジスタ |
| 0040 | RAM            |
|      | VRAM           |
|      | EEPROM         |

### 汎用レジスタ

| Addr |     |               | Func             |
| ---- | --- | ------------- | ---------------- |
| 0000 | x0  | zero          | ゼロ固定         |
| 0001 | x1  | retern_addr   | 戻りアドレス     |
| 0002 | x2  | stack_pointer | スタックポインタ |
| 0003 | x3  |               |                  |
| 0004 | x4  |               |                  |
| 0005 | x5  |               |                  |
| 0006 | x6  |               |                  |
| 0007 | x7  |               |                  |
| 0008 |     |               |                  |
| 0009 |     |               |                  |
| 000A |     |               |                  |
| 000B |     |               |                  |
| 000C |     |               |                  |
| 000D |     |               |                  |
| 000E |     |               |                  |
| 000F |     |               |                  |

### 演算レジスタ

このアーキテクチャでは、演算命令を MOV のエイリアスとして実装します。

あるレジスタにアクセスすることで演算結果を得るようなハードウェアになっているからです。

| Addr |          | Func                       |
| ---- | -------- | -------------------------- |
| 0010 | alu_conf | ALU の入出力レジスタを指定 |
| 0010 | sl       | < 左シフト                 |
| 0011 | sr       | > 右シフト                 |
| 0012 | add      | +                          |
| 0013 | sub      | -                          |
| 0014 | xor      | ^                          |
| 0015 | or       | \|                         |
| 0016 | and      | &                          |
| 0017 | not      | ~                          |
| 0018 |          |                            |
| 0019 |          |                            |
| 001A |          |                            |
| 001B |          |                            |
| 001C |          |                            |
| 001D |          |                            |
| 001E |          |                            |
| 001F |          |                            |

### 入出力レジスタ

| Addr | Func |
| ---- | ---- |
| 0020 | GPIO |
| 0028 | ADC  |
| 002C | DAC  |
| 0030 | PWM  |
| 0038 | I2C  |
| 00   | SPI  |
|      | UART |
