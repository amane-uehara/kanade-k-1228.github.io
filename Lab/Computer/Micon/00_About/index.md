---
title: 自作マイコン
date: 2022-09-23
---

MFT2022、お疲れ様でした。

リレーコンピュータを構想してから 5 年、なんとか完成することができました。

ということで、ようやくトランジスタ縛りから開放されたので、トランジスタで CPU を作って、OS を動かしていきます。

来年の MFT2023 に出せたらいいな…？

## 概要

1. ロジック IC を使って回路を作る

マイコンとかメモリとかを組み合わせてコンピュータを作ってた時代があったらしいですね。

ということで、その時代の雰囲気を再現すべく、できるだけスルーホールの IC を使って作ります。

2. 簡素な CPU

RISC-V を参考に簡単な回路＆機械語になるようにします。

3. 充実した機能

組み込み用としても、パソコンとしても使えるように、周辺回路をマシマシにします。

というのも、CPU の性能が低いので、専用回路で補おうという算段です。

- 割り込み
- DMA
- VGA 映像出力
- キーボード入力
- IO：GPIO、ADC、DAC、PWM
- 通信：I2C、SPI、Serial

## 予定というか野望

1. アーキテクチャの設計
   とりあえず、CPU のアーキテクチャを作ってみます。
   暫定なので、エミュレータを動かしてみたり、回路図を書いたり、いろいろ試行錯誤してるうちに変わっていくはずです

2. 単一ファイルのアセンブラを作る！
   アセンブリと機械語を一対一に変換するだけの単純なアセンブラを作ります

3. エミュレータを作る！
   機械語コードを読んで CPU をエミュレートします
   しばらくはこれでいろいろ動かしてくよ

4. コンパイラを作る！
   C 言語のサブセット、C-- のコンパイラを作ります

5. リンカを作る！
   コンパイラを改造して、オブジェクトファイルを出力するように変更します
   さらに、リンカを作り、オブジェクトファイルをリンクして機械語コードを出力します

6. OS を作る！
   リアルタイム OS を作り、エミュレータ上で動かします（リアルタイムとは
   割り込みとかどうしよ
   テストベンチ作る？

7. ハードウェアを作る！
   この時点で仕様が決まってるはずなので？ロジック IC で CPU を組みます

8. ライタを作る
   PC と通信
   デバドラ作ってみる？

9. デバッガを作る
   パソコン側から、ステップ実行したり、ROM の値を読んだりできるようにします

10. 開発環境を作る！
    VSCode の拡張機能として、フォーマッタ、シンタックスハイライトを実装します
    VSCode のインターフェースを使って実行＆デバッグできるようにします

11. LLVM バックエンドを作る！
    LLVM 神「力が…欲しいか…」
    LLVM の力を借りて、C 言語が完全にサポートされたコンパイラを作ります
